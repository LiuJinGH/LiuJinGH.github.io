<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="流愚">
<meta property="og:url" content="https://liujingh.github.io/index.html">
<meta property="og:site_name" content="流愚">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="流愚">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6338635710714611000,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://liujingh.github.io/"/>

  <title> 流愚 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?a9bf73cc00296d16c37b1bb493b0e1c8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">流愚</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">学海无涯，流愚寻昧</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/01/iOS开发/Swift/Swift基础/Swift基础——可选类型/" itemprop="url">
                  Swift基础——可选类型
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-01T14:52:18+08:00" content="2016-11-01">
              2016-11-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Swift基础/" itemprop="url" rel="index">
                    <span itemprop="name">Swift基础</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/01/iOS开发/Swift/Swift基础/Swift基础——可选类型/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/01/iOS开发/Swift/Swift基础/Swift基础——可选类型/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="可选类型简介"><a href="#可选类型简介" class="headerlink" title="可选类型简介"></a>可选类型简介</h1><p><a href="http://note.youdao.com/noteshare?id=4f46e2da52e365056cdf61d30aed4c25" target="_blank" rel="external">Demo下载_有道云笔记</a></p>
<p>在C语言或其它大多数高级语言中，对于一个数据类型标识其零值和空值往往是混淆的。</p>
<p>比如C语言中，往往用0或-1来标识一个类型是空值，但是如果这个类型真的存在值为0或-1时，就会混淆有值和空值的情况。其它高级语言往往会中NULL，nil等来标识零值，但是对于NULL和nil等到底还是用0来表示，还是无法从根本上解决这个问题。</p>
<p>可选类型则是很大程度上为了解决这个问题而诞生。在Swift中，可选类型可以表示在任何数据类型中，用于区分该数据类型的有值和空值情况。其次，可选类型其实上是一个枚举类型，将数据类型划分为两种情况：空值为nil，有值则为其本身数据类型。</p>
<p>理解可选类型需要注意一下几点：</p>
<ul>
<li>是可以作用于任何数据类型，用?问号修饰</li>
<li>任意的数据类型不可赋值为nil, nil只能作用于可选型类型上</li>
<li>可选类型不能直接使用，需要解包之后在再使用</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//显示定义一个Int可选类型的变量imInt</span></div><div class="line"><span class="keyword">var</span> imInt: <span class="type">Int</span>? = <span class="literal">nil</span></div><div class="line"><span class="comment">//非可选类型不能赋值nil，编译报错</span></div><div class="line"><span class="comment">//var imInt2: Int = nil</span></div><div class="line">imInt = <span class="number">404</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(imInt)</span>"</span>)</div><div class="line"><span class="comment">// 打印结果为：Optional(404) 并非 404</span></div><div class="line"><span class="comment">//这表示Int可选类型虽然有值，但并非是Int类型数据，需要解包。</span></div></pre></td></tr></table></figure>
<h1 id="可选类型解包"><a href="#可选类型解包" class="headerlink" title="可选类型解包"></a>可选类型解包</h1><p>可选类型解包是指将可选类型中的数据从可选类型中解析出来，封装成原数据类型。</p>
<p>例如：在上面例子中：Optional(404)，是一个可选的Int数据类型，其包含了404这个Int数据，解包就是将这个数据拿出来。</p>
<h2 id="强制解包"><a href="#强制解包" class="headerlink" title="强制解包"></a>强制解包</h2><p>强制解包是指无论该可选类型是否有值都进行强制解包，这样会造成当可选类型值为nil的时候，发生编译错误。</p>
<p>强制解包方法：直接在可选类型常量/变量后面加！感叹号</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//强制解包</span></div><div class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(imInt!)</span>"</span>)</div><div class="line"><span class="comment">//但可选类型为nil（空值）时，强制解包编译错误</span></div><div class="line">imInt = <span class="literal">nil</span></div><div class="line"><span class="comment">//print("\(imInt!)")</span></div><div class="line"><span class="comment">//推荐使用安全的强制解包方法</span></div><div class="line"><span class="keyword">if</span> imInt != <span class="literal">nil</span>&#123;</div><div class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(imInt!)</span>"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="if-let解包"><a href="#if-let解包" class="headerlink" title="if let解包"></a>if let解包</h2><p>if let解包是指使用if语言进行判断可选类型是否能够给解包，如果能解包才进行解包</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//if let 解包</span></div><div class="line">imInt = <span class="number">404</span></div><div class="line"><span class="keyword">if</span> <span class="keyword">let</span> imInt3 = imInt&#123;</div><div class="line">    <span class="comment">//解包后的imInt只能在这个作用范围内使用</span></div><div class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(imInt3)</span>"</span>)</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">    <span class="string">"imInt 是空值"</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//打印 404</span></div></pre></td></tr></table></figure>
<h2 id="修饰符：？？"><a href="#修饰符：？？" class="headerlink" title="修饰符：？？"></a>修饰符：？？</h2><p>修饰符？？其实是一个种特殊的空合运算符，适用于可选类型。</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ??运算符 当imInt为nil是，imInt4赋值为200，否则将imInt赋值给imInt4</span></div><div class="line"><span class="keyword">let</span> imInt<span class="number">4</span> = imInt ?? <span class="number">200</span></div></pre></td></tr></table></figure>
<h1 id="可选元组类型的理解"><a href="#可选元组类型的理解" class="headerlink" title="可选元组类型的理解"></a>可选元组类型的理解</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//元组可选类型</span></div><div class="line"><span class="comment">//元组不是可选类型，但元组中的第二个元素是可选类型</span></div><div class="line"><span class="keyword">var</span> errorOne: (errorCode: Int, errorMessage: <span class="built_in">String</span>?) = (<span class="number">404</span>, <span class="string">"Not Found"</span>)</div><div class="line"><span class="comment">//元组是可选类型，但元组中的元素不是可选类型</span></div><div class="line"><span class="keyword">var</span> errorTwo: (errorCode: Int, errorMessage: <span class="built_in">String</span>)? = (<span class="number">404</span>, <span class="string">"Not Found"</span>)</div><div class="line"><span class="comment">//元组是可选类型，且元组中的第二个元组是可选类型</span></div><div class="line"><span class="keyword">var</span> errorThree: (errorCode: Int, errorMessage: <span class="built_in">String</span>?)? = (<span class="number">404</span>, <span class="string">"Not Found"</span>)</div></pre></td></tr></table></figure>
<h2 id="可选型链式表达"><a href="#可选型链式表达" class="headerlink" title="可选型链式表达"></a>可选型链式表达</h2><p>可选型链式表达:作用于嵌套层级的可选类型，可以通过. 点语法，自行判断nil值情况进行下层级元素调用</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">errorThree?.errorMessage!</div><div class="line"><span class="built_in">print</span>(<span class="string">"<span class="subst">\(errorThree?.errorMessage)</span>"</span>)</div><div class="line"><span class="comment">//打印为 Optional("Not Found")</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/25/iOS开发/iOS高级开发/TableView的添加，删除和移动列表操作/" itemprop="url">
                  TableView的添加，删除，移动列表操作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-25T17:09:19+08:00" content="2016-10-25">
              2016-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/25/iOS开发/iOS高级开发/TableView的添加，删除和移动列表操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/25/iOS开发/iOS高级开发/TableView的添加，删除和移动列表操作/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Demo展示"><a href="#Demo展示" class="headerlink" title="Demo展示"></a>Demo展示</h1><p><img src="http://note.youdao.com/yws/api/personal/file/WEB8d57cb05896e2687e9f163534ea8e863?method=download&amp;inline=true&amp;shareKey=02b887db246e2dabccc49db97228073d" alt="TabeViewDemo"></p>
<p><a href="http://note.youdao.com/noteshare?id=6de14ec5182fb6f2ff014a797a984923" target="_blank" rel="external">Demo_有道云笔记下载</a></p>
<blockquote>
<p>对列表项的添加、删除和移动操作都必须和列表的数据源处理同步！！！</p>
</blockquote>
<h1 id="添加操作说明"><a href="#添加操作说明" class="headerlink" title="添加操作说明"></a>添加操作说明</h1><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//插入操作需要调用到该函数 indexPath表示插入列表项的位置  animation表示操作使用到的动画</span></div><div class="line">- (<span class="keyword">void</span>)insertRowsAtIndexPaths:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths withRowAnimation:(<span class="built_in">UITableViewRowAnimation</span>)animation;</div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//代码示例</span></div><div class="line">-(<span class="keyword">void</span> )toAddTableViewCell:(<span class="built_in">UIBarButtonItem</span> *)sender&#123;</div><div class="line">    <span class="comment">//先向数据源增加数据</span></div><div class="line">    [<span class="keyword">self</span>.dataList addObject:<span class="string">@"火龙果"</span>];</div><div class="line">    <span class="comment">//这里是向列表尾部添加列表项，故row值取数据源的最大值</span></div><div class="line">    <span class="built_in">NSInteger</span> lastRow = <span class="keyword">self</span>.dataList.count - <span class="number">1</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">NSIndexPath</span> *indexPath = [<span class="built_in">NSIndexPath</span> indexPathForRow:lastRow inSection:<span class="number">0</span>];</div><div class="line">    <span class="comment">//向列表项进行插入操作</span></div><div class="line">    [<span class="keyword">self</span>.tableView insertRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationTop</span>];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="删除操作说明"><a href="#删除操作说明" class="headerlink" title="删除操作说明"></a>删除操作说明</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//删除操作需要使用到该函数</span></div><div class="line">- (<span class="keyword">void</span>)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">commitEditingStyle:</span>(UITableViewCellEditingStyle)editingStyle <span class="string">forRowAtIndexPath:</span>(NSIndexPath *)indexPath;</div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//代码示例</span></div><div class="line">-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView commitEditingStyle:(<span class="built_in">UITableViewCellEditingStyle</span>)editingStyle forRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//判断编辑类型是否是删除</span></div><div class="line">    <span class="keyword">if</span> (editingStyle == <span class="built_in">UITableViewCellEditingStyleDelete</span>) &#123;</div><div class="line">        [<span class="keyword">self</span>.dataList removeObjectIdenticalTo:<span class="keyword">self</span>.dataList[indexPath.row]];</div><div class="line">        [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:<span class="built_in">UITableViewRowAnimationAutomatic</span>];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="移动操作说明"><a href="#移动操作说明" class="headerlink" title="移动操作说明"></a>移动操作说明</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//实现这个方法，可以让tableView在编辑状态时，出现移动辅助图标，并进行移动列表操作</span></div><div class="line">- (<span class="keyword">void</span>)<span class="string">tableView:</span>(UITableView *)tableView <span class="string">moveRowAtIndexPath:</span>(NSIndexPath *)sourceIndexPath <span class="string">toIndexPath:</span>(NSIndexPath *)destinationIndexPath;</div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//代码示例</span></div><div class="line">-(<span class="keyword">void</span>)tableView:(<span class="built_in">UITableView</span> *)tableView moveRowAtIndexPath:(<span class="built_in">NSIndexPath</span> *)sourceIndexPath toIndexPath:(<span class="built_in">NSIndexPath</span> *)destinationIndexPath&#123;</div><div class="line">    <span class="keyword">id</span> obj = <span class="keyword">self</span>.dataList[sourceIndexPath.row];</div><div class="line">    [<span class="keyword">self</span>.dataList removeObjectAtIndex:sourceIndexPath.row];</div><div class="line">    [<span class="keyword">self</span>.dataList insertObject:obj atIndex:destinationIndexPath.row];</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/25/iOS开发/iOS高级开发/runtime中objc_getAssociatedObject、objc_setAssociatedObject的使用说明/" itemprop="url">
                  runtime中objc_getAssociatedObject、objc_setAssociatedObject的使用说明
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-25T10:34:20+08:00" content="2016-10-25">
              2016-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/25/iOS开发/iOS高级开发/runtime中objc_getAssociatedObject、objc_setAssociatedObject的使用说明/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/25/iOS开发/iOS高级开发/runtime中objc_getAssociatedObject、objc_setAssociatedObject的使用说明/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="方法简介"><a href="#方法简介" class="headerlink" title="方法简介"></a>方法简介</h1><p>objc_getAssociatedObject、objc_setAssociatedObject是runtime机制中对类库进行动态操作属性的两个方法。</p>
<h2 id="objc-getAssociatedObject"><a href="#objc-getAssociatedObject" class="headerlink" title="objc_getAssociatedObject"></a>objc_getAssociatedObject</h2><h3 id="官方定义"><a href="#官方定义" class="headerlink" title="官方定义"></a>官方定义</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function">OBJC_EXPORT id <span class="title">objc_getAssociatedObject</span>(<span class="params">id <span class="keyword">object</span>, <span class="keyword">const</span> <span class="keyword">void</span> *key</span>)</span></div><div class="line">    __<span class="title">OSX_AVAILABLE_STARTING</span>(<span class="params">__MAC_10_6, __IPHONE_3_1</span>);</div></pre></td></tr></table></figure>
<h3 id="官方注解"><a href="#官方注解" class="headerlink" title="官方注解"></a>官方注解</h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/** </div><div class="line"> * Returns the value associated <span class="keyword">with</span> a given <span class="built_in">object</span> <span class="keyword">for</span> a given <span class="keyword">key</span>.</div><div class="line"> * </div><div class="line"> * @param <span class="built_in">object</span> The source <span class="built_in">object</span> <span class="keyword">for</span> the association.</div><div class="line"> * @param <span class="keyword">key</span> The <span class="keyword">key</span> <span class="keyword">for</span> the association.</div><div class="line"> * </div><div class="line"> * @<span class="keyword">return</span> The value associated <span class="keyword">with</span> the <span class="keyword">key</span> \e <span class="keyword">key</span> <span class="keyword">for</span> \e <span class="built_in">object</span>.</div><div class="line"> * </div><div class="line"> * @see objc_setAssociatedObject</div><div class="line"> */</div></pre></td></tr></table></figure>
<h3 id="个人注解"><a href="#个人注解" class="headerlink" title="个人注解"></a>个人注解</h3><ul>
<li>objc_getAssociatedObject方法是获取动态类库属性的一个方法。</li>
<li>参数：object 是指明要获取的属性是来自哪个实例对象</li>
<li>参数：key 是用来标识该属性</li>
<li>函数返回参数中对应对象的对应属性</li>
</ul>
<h2 id="objc-setAssociatedObject"><a href="#objc-setAssociatedObject" class="headerlink" title="objc_setAssociatedObject"></a>objc_setAssociatedObject</h2><h3 id="官方定义-1"><a href="#官方定义-1" class="headerlink" title="官方定义"></a>官方定义</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function">OBJC_EXPORT <span class="keyword">void</span> <span class="title">objc_setAssociatedObject</span>(<span class="params">id <span class="keyword">object</span>, <span class="keyword">const</span> <span class="keyword">void</span> *key, id <span class="keyword">value</span>, objc_AssociationPolicy policy</span>)</span></div><div class="line">    __<span class="title">OSX_AVAILABLE_STARTING</span>(<span class="params">__MAC_10_6, __IPHONE_3_1</span>);</div></pre></td></tr></table></figure>
<h3 id="官方注解-1"><a href="#官方注解-1" class="headerlink" title="官方注解"></a>官方注解</h3><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/** </div><div class="line"> * Sets an associated value <span class="keyword">for</span> a given <span class="built_in">object</span> <span class="keyword">using</span> a given <span class="keyword">key</span> <span class="keyword">and</span> association policy.</div><div class="line"> * </div><div class="line"> * @param <span class="built_in">object</span> The source <span class="built_in">object</span> <span class="keyword">for</span> the association.</div><div class="line"> * @param <span class="keyword">key</span> The <span class="keyword">key</span> <span class="keyword">for</span> the association.</div><div class="line"> * @param value The value <span class="keyword">to</span> associate <span class="keyword">with</span> the <span class="keyword">key</span> <span class="keyword">key</span> <span class="keyword">for</span> <span class="built_in">object</span>. Pass nil <span class="keyword">to</span> clear an existing association.</div><div class="line"> * @param policy The policy <span class="keyword">for</span> the association. <span class="keyword">For</span> possible values, see “Associative <span class="built_in">Object</span> Behaviors.”</div><div class="line"> * </div><div class="line"> * @see objc_setAssociatedObject</div><div class="line"> * @see objc_removeAssociatedObjects</div><div class="line"> */</div></pre></td></tr></table></figure>
<h3 id="个人注解-1"><a href="#个人注解-1" class="headerlink" title="个人注解"></a>个人注解</h3><ul>
<li>objc_setAssociatedObject方法是动态设置类库中属性的一个方法。</li>
<li>参数：object 指明要动态设置属性实例对象</li>
<li>参数：key 为该属性设置一个标识</li>
<li>参数：value 设置设个属性的值</li>
<li>参数：policy 设置该属性的关联策略</li>
</ul>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123;</div><div class="line"><span class="comment">/**&lt; Specifies a weak reference to the associated object. */</span></div><div class="line">    <span class="comment">//弱引用 weak</span></div><div class="line">    OBJC_ASSOCIATION_ASSIGN = <span class="number">0</span>,  </div><div class="line">    </div><div class="line"><span class="comment">/**&lt; Specifies a strong reference to the associated object.     *   The association is not made atomically. */</span></div><div class="line">    <span class="comment">//强引用，非原子性 strong nonatomic</span></div><div class="line">    OBJC_ASSOCIATION_RETAIN_NONATOMIC = <span class="number">1</span>, </div><div class="line">    </div><div class="line"><span class="comment">/**&lt; Specifies that the associated object is copied.     *   The association is not made atomically. */</span></div><div class="line">    <span class="comment">//拷贝，非原子性 copy nonatomic</span></div><div class="line">    OBJC_ASSOCIATION_COPY_NONATOMIC = <span class="number">3</span>, </div><div class="line">    </div><div class="line"><span class="comment">/**&lt; Specifies a strong reference to the associated object.    *   The association is made atomically. */</span></div><div class="line">    <span class="comment">//强引用，原子性 strong atomic</span></div><div class="line">    OBJC_ASSOCIATION_RETAIN = <span class="number">01401</span>,  </div><div class="line">    </div><div class="line"><span class="comment">/**&lt; Specifies that the associated object is copied.    *   The association is made atomically. */</span></div><div class="line">    <span class="comment">//拷贝，原子性 copy atomic</span></div><div class="line">    OBJC_ASSOCIATION_COPY = <span class="number">01403</span>          </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h1 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h1><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>在使用未开源的源码时，往往会使用分类来增加原始类的方法。但是，在分类中不能定义成员变量，这也导致无法给原始类增加成员变量。解决这个问题的其中一个方法就是使用runtime的objc_getAssociatedObject和objc_setAssociatedObject来为原始类的实例对象动态增加一个属性。</p>
<p><a href="http://note.youdao.com/noteshare?id=fe39374f234a0cdb718f23f2bb575d62" target="_blank" rel="external">源码连接_有道云笔记</a></p>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><p>新建一个NSString类型的分类</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在.h文件中</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="comment">//需要导入的头文件</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSString</span> (<span class="title">LJ_runtime_Demo</span>)</span></div><div class="line"><span class="comment">//定义了一个属性，当实现了它的getter和setter方法</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSString</span> *ljDemo;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在.m文件中</span></div><div class="line"><span class="meta">#import <span class="meta-string">"NSString+LJ_runtime_Demo.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSString</span> (<span class="title">LJ_runtime_Demo</span>)</span></div><div class="line"></div><div class="line">-(<span class="built_in">NSString</span> *)ljDemo&#123;</div><div class="line">    <span class="keyword">return</span> objc_getAssociatedObject(<span class="keyword">self</span>, <span class="string">@"LJDEMO"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(<span class="keyword">void</span>)setLjDemo:(<span class="built_in">NSString</span> *)ljDemo&#123;</div><div class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, <span class="string">@"LJDEMO"</span>, ljDemo, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在main函数中</span></div><div class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</div><div class="line">    <span class="keyword">@autoreleasepool</span> &#123;</div><div class="line">        <span class="built_in">NSString</span> *str = <span class="string">@"这是测试Demo"</span>;</div><div class="line">        str.ljDemo = <span class="string">@"您好，美丽的世界"</span>;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, str.ljDemo);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">//</span>打印测试</div><div class="line"><span class="number">2016</span>-<span class="number">10</span>-<span class="number">25</span> <span class="number">11</span>:<span class="number">33</span>:<span class="number">07.100</span> LJ_runtime_AssociatedObject_Demo[<span class="number">3571</span>:<span class="number">113511</span>] 您好，美丽的世界</div><div class="line">Program ended with <span class="keyword">exit</span> code: <span class="number">0</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/24/iOS开发/Demo/WMPageController/" itemprop="url">
                  WMPageController
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-24T02:13:25+08:00" content="2016-10-24">
              2016-10-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/24/iOS开发/Demo/WMPageController/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/24/iOS开发/Demo/WMPageController/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="WMPageController简介"><a href="#WMPageController简介" class="headerlink" title="WMPageController简介"></a>WMPageController简介</h1><p>上方切换栏效果的控制器</p>
<p><a href="https://github.com/wangmchn/WMPageController" target="_blank" rel="external">WMPageControllerHithub链接</a></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB47e983d7db17742d006d6b0121973a7f?method=download&amp;inline=true&amp;shareKey=2f27af2463eeb1dfde7d353249ebfccc" alt="Demo图片"></p>
<h1 id="WMPageController使用说明"><a href="#WMPageController使用说明" class="headerlink" title="WMPageController使用说明"></a>WMPageController使用说明</h1><h2 id="使用注意点"><a href="#使用注意点" class="headerlink" title="使用注意点"></a>使用注意点</h2><ul>
<li><p>WMPageController是国人写的一个第三方，固然有中文注释。所以有关属性和方法的说明，可以直接到源码中看注释即可。</p>
</li>
<li><p>WMPageController的部分属性配置不能在viewDidLoad方法中设置，只能在其之前，比如：初始化方法或loadView方法</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//目前发现这三个属性符合以上说明</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">BOOL</span> showOnNavigationBar;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) WMMenuViewStyle menuViewStyle;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIColor</span> *menuBGColor;</div></pre></td></tr></table></figure>
<ul>
<li>WMPageController对子层ViewController有缓存机制，如果子层ViewController是第一次加载，会调用以下方法，否则不会再次调用。</li>
</ul>
<figure class="highlight erlang"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- <span class="params">(__kindof UIViewController *)</span>pageController:<span class="params">(WMPageController *)</span>pageController viewControllerAtIndex:<span class="params">(NSInteger)</span>index;</div></pre></td></tr></table></figure>
<ul>
<li>WMPageController在viewDidAppear方法中设置了标题栏的一些动画操作。</li>
</ul>
<p>使用步骤</p>
<ul>
<li>需要新建一个类，继承WMPageController</li>
<li>设置标题栏的一些属性</li>
<li>实现相关父类方法</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *titles;</div><div class="line"></div><div class="line">- (<span class="built_in">NSInteger</span>)numbersOfChildControllersInPageController:(WMPageController *)pageController;</div><div class="line"></div><div class="line">- (__kindof <span class="built_in">UIViewController</span> *)pageController:(WMPageController *)pageController viewControllerAtIndex:(<span class="built_in">NSInteger</span>)index;</div></pre></td></tr></table></figure>
<p><a href="http://note.youdao.com/noteshare?id=e406af192ace47dbca3828ff5638e684" target="_blank" rel="external">Demo下载_有道云笔记</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/21/iOS开发/UIKit/UIViewController/UIViewController生命周期/" itemprop="url">
                  UIViewController生命周期
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-21T19:23:27+08:00" content="2016-10-21">
              2016-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/21/iOS开发/UIKit/UIViewController/UIViewController生命周期/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/21/iOS开发/UIKit/UIViewController/UIViewController生命周期/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="UIViewController生命周期简介"><a href="#UIViewController生命周期简介" class="headerlink" title="UIViewController生命周期简介"></a>UIViewController生命周期简介</h1><p>UIViewController作为UIView的管理容器，当UIView处于不同的阶段的时候，会发出不同的消息。图示如下：</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBdb9680cdf946c2e4cd72cfa684c162c3?method=download&amp;inline=true&amp;shareKey=570245f7c5544c082e7df997db3a425c" alt="image"></p>
<h1 id="UIViewController生命周期方法介绍"><a href="#UIViewController生命周期方法介绍" class="headerlink" title="UIViewController生命周期方法介绍"></a>UIViewController生命周期方法介绍</h1><h2 id="loadView"><a href="#loadView" class="headerlink" title="loadView"></a>loadView</h2><h3 id="方法定义"><a href="#方法定义" class="headerlink" title="方法定义"></a>方法定义</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadView</span><span class="params">()</span></span></div><div class="line"><span class="comment">//OC</span></div><div class="line">- (void)loadView</div></pre></td></tr></table></figure>
<h3 id="官方释义"><a href="#官方释义" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>You should never call this method directly. The view controller calls this method when its view property is requested but is currently nil. This method loads or creates a view and assigns it to the view property.</p>
<p>If the view controller has an associated nib file, this method loads the view from the nib file. A view controller has an associated nib file if the nibName property returns a non-nil value, which occurs if the view controller was instantiated from a storyboard, if you explicitly assigned it a nib file using the initWithNibName:bundle: method, or if iOS finds a nib file in the app bundle with a name based on the view controller’s class name. If the view controller does not have an associated nib file, this method creates a plain UIView object instead.</p>
<p>If you use Interface Builder to create your views and initialize the view controller, you must not override this method.</p>
<p>You can override this method in order to create your views manually. If you choose to do so, assign the root view of your view hierarchy to the view property. The views you create should be unique instances and should not be shared with any other view controller object. Your custom implementation of this method should not call super.</p>
<p>If you want to perform any additional initialization of your views, do so in the viewDidLoad method.</p>
</blockquote>
<h3 id="方法注解"><a href="#方法注解" class="headerlink" title="方法注解"></a>方法注解</h3><ul>
<li>苹果官方不建议我们直接调用这个函数。当UIViewController发现需要使用到view属性但它又是nil的时候，就会调用这个方法来加载或创建一个UIView对象赋值给这个属性。</li>
<li>如果你使用的是图形界面的方式初始化UIViewController和创建view，那么禁止重写这个方法。</li>
<li>当我们想要自定义自己的view层级时，可以重写这个方法，并将这个视图层级的根视图赋值给view属性。需要注意的二点：其一，需要保证这个视图层级是唯一的；其二，重写方法不应该重调super的方法。</li>
<li>如果我们想要展示一些额外的视图实例，可以在viewDidLoad中实现。</li>
</ul>
<h2 id="viewDidLoad"><a href="#viewDidLoad" class="headerlink" title="viewDidLoad"></a>viewDidLoad</h2><h3 id="方法定义-1"><a href="#方法定义-1" class="headerlink" title="方法定义"></a>方法定义</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span></div><div class="line"><span class="comment">//OC</span></div><div class="line">- (void)viewDidLoad</div></pre></td></tr></table></figure>
<h3 id="官方释义-1"><a href="#官方释义-1" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>This method is called after the view controller has loaded its view hierarchy into memory. This method is called regardless of whether the view hierarchy was loaded from a nib file or created programmatically in the loadView method. You usually override this method to perform additional initialization on views that were loaded from nib files.</p>
</blockquote>
<h3 id="方法注解-1"><a href="#方法注解-1" class="headerlink" title="方法注解"></a>方法注解</h3><ul>
<li>当ViewController已经将它的视图层级加载在内存当中时，这个方法就会被调用。这个方法经常使用来对视图层级添加一些额外设置的。</li>
<li>一般来说，ViewController的loadView、viewDidLoad方法只会在ViewController的生命周期中调用一次。如果主动将ViewController的view置为nil，且又在其它生命周期方法使用到view的getter方法，那么会导致ViewController重新调用laodView、viewDidLoad方法,引发死循环或其它莫名其妙的问题，而且这类问题很可能不会有提示。</li>
</ul>
<h2 id="viewWillAppear"><a href="#viewWillAppear" class="headerlink" title="viewWillAppear"></a>viewWillAppear</h2><h3 id="方法定义-2"><a href="#方法定义-2" class="headerlink" title="方法定义"></a>方法定义</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="selector-tag">func</span> <span class="selector-tag">viewWillAppear</span>(_ <span class="attribute">animated</span>: Bool)</div><div class="line"><span class="comment">//OC</span></div><div class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">viewWillAppear</span><span class="selector-pseudo">:(BOOL)animated</span></div></pre></td></tr></table></figure>
<h3 id="官方释义-2"><a href="#官方释义-2" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>This method is called before the view controller’s view is about to be added to a view hierarchy and before any animations are configured for showing the view. You can override this method to perform custom tasks associated with displaying the view. For example, you might use this method to change the orientation or style of the status bar to coordinate with the orientation or style of the view being presented. If you override this method, you must call super at some point in your implementation.</p>
<p>If a view controller is presented by a view controller inside of a popover, this method is not invoked on the presenting view controller after the presented controller is dismissed.</p>
</blockquote>
<h3 id="方法注解-2"><a href="#方法注解-2" class="headerlink" title="方法注解"></a>方法注解</h3><ul>
<li>这个方法在ViewController的View视图层级将要做出显示且在显示动画之前调用，重写这个方法可以操作一些与View视图层级显示相关的任务。如果你重写这个方法，你必须要实现它的父类方法</li>
<li>如果一个视图控制器被另一个视图控制器以内嵌popover的方式呈现，那么这个呈现视图的viewWillAppear方法不会在被呈现的视图控制器退出之后调用</li>
</ul>
<h2 id="viewDidAppear"><a href="#viewDidAppear" class="headerlink" title="viewDidAppear"></a>viewDidAppear</h2><h3 id="方法定义-3"><a href="#方法定义-3" class="headerlink" title="方法定义"></a>方法定义</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="selector-tag">func</span> <span class="selector-tag">viewDidAppear</span>(_ <span class="attribute">animated</span>: Bool)</div><div class="line"><span class="comment">//OC</span></div><div class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">viewDidAppear</span><span class="selector-pseudo">:(BOOL)animated</span></div></pre></td></tr></table></figure>
<h3 id="官方释义-3"><a href="#官方释义-3" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>You can override this method to perform additional tasks associated with presenting the view. If you override this method, you must call super at some point in your implementation.</p>
</blockquote>
<h3 id="方法注解-3"><a href="#方法注解-3" class="headerlink" title="方法注解"></a>方法注解</h3><ul>
<li>当ViewController已经的视图层级已经显示之后调用这个方法，重写这个方法必须要实现它的父类方法。</li>
</ul>
<h2 id="viewWillDisappear"><a href="#viewWillDisappear" class="headerlink" title="viewWillDisappear"></a>viewWillDisappear</h2><h3 id="方法定义-4"><a href="#方法定义-4" class="headerlink" title="方法定义"></a>方法定义</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="selector-tag">func</span> <span class="selector-tag">viewWillDisappear</span>(_ <span class="attribute">animated</span>: Bool)</div><div class="line"><span class="comment">//OC</span></div><div class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">viewWillDisappear</span><span class="selector-pseudo">:(BOOL)animated</span></div></pre></td></tr></table></figure>
<h3 id="官方释义-4"><a href="#官方释义-4" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>This method is called in response to a view being removed from a view hierarchy. This method is called before the view is actually removed and before any animations are configured.</p>
<p>Subclasses can override this method and use it to commit editing changes, resign the first responder status of the view, or perform other relevant tasks. For example, you might use this method to revert changes to the orientation or style of the status bar that were made in the viewDidDisappear: method when the view was first presented. If you override this method, you must call super at some point in your implementation</p>
</blockquote>
<h3 id="方法注解-4"><a href="#方法注解-4" class="headerlink" title="方法注解"></a>方法注解</h3><h2 id="viewDidDisappear"><a href="#viewDidDisappear" class="headerlink" title="viewDidDisappear"></a>viewDidDisappear</h2><h3 id="方法定义-5"><a href="#方法定义-5" class="headerlink" title="方法定义"></a>方法定义</h3><ul>
<li>当ViewController的view已经从视图层级上移除且还没配置动画之前调用这个方法。</li>
<li>重写这个方法一般是用来处理view移除后的一些事物，如注销第一响应者状态等。</li>
<li>重写这个方法必须实现它的父类方法。</li>
</ul>
<figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift</span></div><div class="line"><span class="selector-tag">func</span> <span class="selector-tag">viewDidDisappear</span>(_ <span class="attribute">animated</span>: Bool)</div><div class="line"><span class="comment">//OC</span></div><div class="line"><span class="selector-tag">-</span> (void)<span class="selector-tag">viewDidDisappear</span><span class="selector-pseudo">:(BOOL)animated</span></div></pre></td></tr></table></figure>
<h3 id="官方释义-5"><a href="#官方释义-5" class="headerlink" title="官方释义"></a>官方释义</h3><blockquote>
<p>You can override this method to perform additional tasks associated with dismissing or hiding the view. If you override this method, you must call super at some point in your implementation.</p>
</blockquote>
<h3 id="方法注解-5"><a href="#方法注解-5" class="headerlink" title="方法注解"></a>方法注解</h3><ul>
<li>当ViewController的view从屏幕上消失时，调用这个方法。</li>
<li>重写这个方法必须实现它的父类方法。</li>
</ul>
<h2 id="嵌套VC调用顺序"><a href="#嵌套VC调用顺序" class="headerlink" title="嵌套VC调用顺序"></a>嵌套VC调用顺序</h2><p><img src="http://note.youdao.com/yws/api/personal/file/WEBb65920b48628e51d95a0056c0517e02e?method=download&amp;inline=true&amp;shareKey=51048903bba58394e6cd9a5b386c6b28" alt="image"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/19/iOS开发/其他/iOS地图/" itemprop="url">
                  iOS地图
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-19T09:09:27+08:00" content="2016-10-19">
              2016-10-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/19/iOS开发/其他/iOS地图/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/19/iOS开发/其他/iOS地图/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="iOS地图简介"><a href="#iOS地图简介" class="headerlink" title="iOS地图简介"></a>iOS地图简介</h1><p>苹果一般使用的谷歌、高德地图。但在大天朝谷歌地图用不了，所以一般使用高德地图。</p>
<p>有关iOS 高德地图的一些API介绍</p>
<blockquote>
<p>MapKit.framework 使用高德地图时，需要导入MapKit框架。</p>
<p>MKMapView 地图视图，在iOS中其父类继承的是UIView，在MacOS中其父类继承的是NSView。其主要功能是将地图以视图形式显示出来</p>
<p>CLGeocoder 地理编码器，其主要功能是将地理位置转化为经纬度，或将经纬度转化为地理位置。</p>
<p>CLPlacemark 地标，存储了指定经纬度的地标信息，诸如国家，城市，街道等。</p>
<p>CLLocationManager 定位管理器，用于设置地图中的定位服务。</p>
<p>CLLocation 位置，封装了以经纬度为基点的地理信息，与地标不同的是，它没有包含具体位置信息。</p>
<p>MKAnnotationView 位置注释视图，其主要功能为标记一个位置信息</p>
</blockquote>
<h1 id="iOS地图的使用"><a href="#iOS地图的使用" class="headerlink" title="iOS地图的使用"></a>iOS地图的使用</h1><h2 id="向工程中导入MapKit框架"><a href="#向工程中导入MapKit框架" class="headerlink" title="向工程中导入MapKit框架"></a>向工程中导入MapKit框架</h2><h3 id="进入工程配置文件"><a href="#进入工程配置文件" class="headerlink" title="进入工程配置文件"></a>进入工程配置文件</h3><p><img src="http://note.youdao.com/yws/api/personal/file/WEBd7fd48be47c6cfe1e7131e70f05f36b2?method=download&amp;inline=true&amp;shareKey=b534bbad14aa37dcc2e85a3de5c6d2e8" alt="image"></p>
<h3 id="选择添加工程框架"><a href="#选择添加工程框架" class="headerlink" title="选择添加工程框架"></a>选择添加工程框架</h3><p><img src="http://note.youdao.com/yws/api/personal/file/WEBca73cda57994c8ee2daeee4e141721f4?method=download&amp;inline=true&amp;shareKey=42c38260f8e71c26dee817e663c43899" alt="image"></p>
<h3 id="添加MapKit框架"><a href="#添加MapKit框架" class="headerlink" title="添加MapKit框架"></a>添加MapKit框架</h3><p><img src="http://note.youdao.com/yws/api/personal/file/WEBd59a4ec036264234f5d9ce5ee9d7db67?method=download&amp;inline=true&amp;shareKey=086694a2881d3af13d255deb3bfbf28e" alt="image"></p>
<h3 id="添加成功显示"><a href="#添加成功显示" class="headerlink" title="添加成功显示"></a>添加成功显示</h3><p><img src="http://note.youdao.com/yws/api/personal/file/WEB296d384b6f083443a0b67b42265cec49?method=download&amp;inline=true&amp;shareKey=339772dccc66f99d2c81977393c8adcf" alt="image"></p>
<h2 id="使用MKMapView显示地图"><a href="#使用MKMapView显示地图" class="headerlink" title="使用MKMapView显示地图"></a>使用MKMapView显示地图</h2><h3 id="导入相关包"><a href="#导入相关包" class="headerlink" title="导入相关包"></a>导入相关包</h3><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@<span class="meta"><span class="meta-keyword">import</span> MapKit;</span>  <span class="comment">//显示地图</span></div><div class="line">@<span class="meta"><span class="meta-keyword">import</span> CoreLocation;</span>  <span class="comment">// 地位服务</span></div></pre></td></tr></table></figure>
<h3 id="使用MKMapView显示地图-1"><a href="#使用MKMapView显示地图-1" class="headerlink" title="使用MKMapView显示地图"></a>使用MKMapView显示地图</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="variable">@interface</span> ViewController ()</div><div class="line"><span class="comment">//定义一个MKMapView属性</span></div><div class="line"><span class="variable">@property</span> (nonatomic) MKMapView *mapView;</div><div class="line"><span class="variable">@end</span></div></pre></td></tr></table></figure>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</div><div class="line">    [<span class="keyword">super</span> viewDidLoad];</div><div class="line">    </div><div class="line">    _mapView = [[<span class="built_in">MKMapView</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</div><div class="line">    _mapView.mapType = <span class="built_in">MKMapTypeStandard</span>;</div><div class="line">    [<span class="keyword">self</span>.view addSubview:_mapView];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="mapType的选择"><a href="#mapType的选择" class="headerlink" title="mapType的选择"></a>mapType的选择</h3><p>在MKMapView中，mapType属性决定了地图显示的样式。在苹果官方定义中有如下</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">typedef <span class="type">NS_ENUM</span>(<span class="type">NSUInteger</span>, <span class="type">MKMapType</span>) &#123;</div><div class="line">    <span class="type">MKMapTypeStandard</span> = 0,</div><div class="line">    <span class="type">MKMapTypeSatellite</span>,</div><div class="line">    <span class="type">MKMapTypeHybrid</span>,</div><div class="line">    <span class="type">MKMapTypeSatelliteFlyover</span>,</div><div class="line">    <span class="type">MKMapTypeHybridFlyover</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="MKMapTypeStandard样式"><a href="#MKMapTypeStandard样式" class="headerlink" title="MKMapTypeStandard样式"></a>MKMapTypeStandard样式</h4><p>标准地图</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB2aa39d24b6777b3f2167784a406162f8?method=download&amp;inline=true&amp;shareKey=bffe54bbcd3310f7daa8c5802ba7ce1f" alt="image"></p>
<h4 id="MKMapTypeSatellite样式"><a href="#MKMapTypeSatellite样式" class="headerlink" title="MKMapTypeSatellite样式"></a>MKMapTypeSatellite样式</h4><p>卫星地图（这个没有位置标识，几乎看不懂）</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB7d3db7b13c6f2b36156d474663f6306a?method=download&amp;inline=true&amp;shareKey=9b278e8ca811e5b6f18d856bdd5111c0" alt="image"></p>
<h4 id="MKMapTypeHybrid样式"><a href="#MKMapTypeHybrid样式" class="headerlink" title="MKMapTypeHybrid样式"></a>MKMapTypeHybrid样式</h4><p>混合地图 （在卫星地图上添加了位置标识）</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB9ef1676cefcbab9b0abfb4abdb6b99cc?method=download&amp;inline=true&amp;shareKey=4a5e582d5f8cbbfafb8641c931329ed6" alt="image"></p>
<h2 id="使用CLLocationManager定位服务"><a href="#使用CLLocationManager定位服务" class="headerlink" title="使用CLLocationManager定位服务"></a>使用CLLocationManager定位服务</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义一个属性</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CLLocationManager</span> *mgr;</div><div class="line"></div><div class="line"><span class="comment">//在viewDidLoad中实现</span></div><div class="line"></div><div class="line">_mapView.showsUserLocation = <span class="literal">YES</span>;</div><div class="line"></div><div class="line">_mgr = [<span class="built_in">CLLocationManager</span> new];</div><div class="line"><span class="comment">//任何时候都定位  前台+后台</span></div><div class="line">[_mgr requestAlwaysAuthorization];</div><div class="line"><span class="comment">//只有在前台的时候才定位</span></div><div class="line">[_mgr requestWhenInUseAuthorization];</div><div class="line"><span class="comment">//以上两个定位方式依需选择，定位服务是非常耗电的！</span></div></pre></td></tr></table></figure>
<p>在info.plist中添加信息</p>
<blockquote>
<p>NSLocationAlwaysUsageDescription 值：申请使用定位服务</p>
</blockquote>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBa9c537e91a16d01ef2f5c82533fb623a?method=download&amp;inline=true&amp;shareKey=bb28e86a98d4257eedd75ce586563ed6" alt="image"></p>
<p>打开模拟器，会提示授权定位服务</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBd189bfb18df62b8f3642ccd6b1a2ff4e?method=download&amp;inline=true&amp;shareKey=0a1f6e15a505f3ec169fba52b967a2bf" alt="image"></p>
<p>点击允许之后，要使用模拟器给定一个模拟位置。</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB3b2d20bbcba871c0d2b8524edcbcdbef?method=download&amp;inline=true&amp;shareKey=3f9908818e9c5b7e5c13f7f3b5d27730" alt="image"></p>
<p>输入模拟位置的经纬度</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBfa9bd6e089d22125e980ce1c98fe1068?method=download&amp;inline=true&amp;shareKey=6f98e49b411e0ab693482af85c9fd6e2" alt="image"></p>
<p>至此，地图在模拟器上出现定位的标识点</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB30ab53e8f7bb9c8dcfc454b0f316a6f5?method=download&amp;inline=true&amp;shareKey=8df6541b23385445e340ebdf633e24fd" alt="image"></p>
<h2 id="使用代理方法以拉近定位点的显示"><a href="#使用代理方法以拉近定位点的显示" class="headerlink" title="使用代理方法以拉近定位点的显示"></a>使用代理方法以拉近定位点的显示</h2><p>代理方法</p>
<blockquote>
<p>MKMapViewDelegate</p>
</blockquote>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB7a4728c0e01c807794503b3741aa579b?method=download&amp;inline=true&amp;shareKey=495546f4f28173df93984fa9a1018c8d" alt="image"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//找到.m文件顶部，添加MKMapViewDelegate</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">MKMapViewDelegate</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">//在viewDidLoad中实现</span></div><div class="line"><span class="comment">//设置代理</span></div><div class="line">_mapView.delegate = <span class="keyword">self</span>;</div><div class="line"></div><div class="line"><span class="comment">//实现代理方法</span></div><div class="line">-(<span class="keyword">void</span>)mapView:(<span class="built_in">MKMapView</span> *)mapView didUpdateUserLocation:(<span class="built_in">MKUserLocation</span> *)userLocation&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//控制地图显示的区域</span></div><div class="line">    <span class="built_in">MKCoordinateSpan</span> span = <span class="built_in">MKCoordinateSpanMake</span>(<span class="number">.01</span>, <span class="number">.01</span>);</div><div class="line">    <span class="built_in">MKCoordinateRegion</span> region = <span class="built_in">MKCoordinateRegionMake</span>(userLocation.location.coordinate, span);</div><div class="line">    [_mapView setRegion:region animated:<span class="literal">YES</span>];</div><div class="line">    </div><div class="line">    <span class="comment">//关闭定位服务</span></div><div class="line">    [_mgr stopUpdatingLocation];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>MKCoordinateRegion 表示地图上的一块区域，center表示以经纬度表示的区域中心点，span表示这块区域的大小</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">	<span class="built_in">CLLocationCoordinate2D</span> center;</div><div class="line">	<span class="built_in">MKCoordinateSpan</span> span;</div><div class="line">&#125; <span class="built_in">MKCoordinateRegion</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>MKCoordinateSpan 它有两个字段一个是latitudeDelta，表示纬度范围，南纬和北纬加一起应该有180度，所以它的范围应该是大于0度，小于等于180度；另一个是longitudeDelta，表示经度范围，东经和西经加一起应该有360度，所以它的范围应该是大于0度，小于360度。</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="built_in">CLLocationDegrees</span> latitudeDelta;</div><div class="line">    <span class="built_in">CLLocationDegrees</span> longitudeDelta;</div><div class="line">&#125; <span class="built_in">MKCoordinateSpan</span>;</div></pre></td></tr></table></figure>
<h2 id="扩展1：拾取坐标器"><a href="#扩展1：拾取坐标器" class="headerlink" title="扩展1：拾取坐标器"></a>扩展1：拾取坐标器</h2><ul>
<li><p>每个地图系统经纬度对应的实际地理位置是不同的，有一定的差距。这据说是每个地图系统的算法不同导致的。</p>
</li>
<li><p><a href="http://api.map.baidu.com/lbsapi/getpoint/index.html" target="_blank" rel="external">百度坐标拾取器</a></p>
</li>
<li><p><a href="http://lbs.amap.com/console/show/picker" target="_blank" rel="external">高德坐标拾取器</a></p>
</li>
</ul>
<h2 id="扩展2：地理编码器"><a href="#扩展2：地理编码器" class="headerlink" title="扩展2：地理编码器"></a>扩展2：地理编码器</h2><h3 id="地理编码"><a href="#地理编码" class="headerlink" title="地理编码"></a>地理编码</h3><p>地理编码是指将地理位置转化为经纬度</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CLGeocoder</span> *geo = [<span class="built_in">CLGeocoder</span> new];</div><div class="line">[geo geocodeAddressString:<span class="string">@"中国北京市朝阳区松榆北路建业"</span> completionHandler:^(<span class="built_in">NSArray</span>&lt;<span class="built_in">CLPlacemark</span> *&gt; * _Nullable placemarks, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">        </div><div class="line">    <span class="built_in">CLPlacemark</span> *place = placemarks.firstObject;</div><div class="line">    <span class="built_in">CLLocation</span> *location = place.location;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, location);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<blockquote>
<p>&lt;+39.87614400,+116.47236900&gt; +/- 100.00m (speed -1.00 mps / course -1.00)</p>
</blockquote>
<h3 id="地理反编码"><a href="#地理反编码" class="headerlink" title="地理反编码"></a>地理反编码</h3><p>地理反编码是指将经纬度转化为地理位置</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CLLocation</span> *location = [[<span class="built_in">CLLocation</span> alloc] initWithLatitude:<span class="number">39.9368</span> longitude:<span class="number">116.453119</span>];</div><div class="line">[[<span class="built_in">CLGeocoder</span> new] reverseGeocodeLocation:location completionHandler:^(<span class="built_in">NSArray</span>&lt;<span class="built_in">CLPlacemark</span> *&gt; * _Nullable placemarks, <span class="built_in">NSError</span> * _Nullable error) &#123;</div><div class="line">    <span class="built_in">CLPlacemark</span> *place = placemarks.firstObject;</div><div class="line">    <span class="built_in">NSDictionary</span> *dic = place.addressDictionary;</div><div class="line">    <span class="built_in">CLLocation</span> *location = place.location;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, location);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>由于控制台输出会乱码，这里用断点来查看</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB4ce1e04aa35e0a009ccf64bf08aef0dd?method=download&amp;inline=true&amp;shareKey=b8b42493bdaa4132e216b86fac8e736d" alt="image"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/13/iOS开发/Demo/iOS毛玻璃效果/" itemprop="url">
                  iOS毛玻璃效果
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-13T10:09:18+08:00" content="2016-10-13">
              2016-10-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/13/iOS开发/Demo/iOS毛玻璃效果/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/13/iOS开发/Demo/iOS毛玻璃效果/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="iOS毛玻璃效果"><a href="#iOS毛玻璃效果" class="headerlink" title="iOS毛玻璃效果"></a>iOS毛玻璃效果</h1><p>这个Demo实现了iOS编程中的毛玻璃效果。</p>
<blockquote>
<p><a href="https://github.com/LiuJinGH/LJiOSForstedGlassDemo" target="_blank" rel="external">Github下载Demo</a></p>
<p><a href="http://note.youdao.com/noteshare?id=9dd868287e7a10af3668625d7f791a6e" target="_blank" rel="external">有道云下载Demo</a></p>
</blockquote>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB0103d8a0f2e902c4183967cb2e2c07b5?method=download&amp;inline=true&amp;shareKey=dc69bc34e7952405f78963fbc61a3617" alt="iOS毛玻璃效果"></p>
<h1 id="实现方法简介"><a href="#实现方法简介" class="headerlink" title="实现方法简介"></a>实现方法简介</h1><h2 id="iOS8-及以后版本"><a href="#iOS8-及以后版本" class="headerlink" title="iOS8 及以后版本"></a>iOS8 及以后版本</h2><p>在iOS8中，添加了毛玻璃效果的API，可以直接拿来使用。</p>
<p>承载毛玻璃效果的View</p>
<blockquote>
<p>UIVisualEffectView</p>
</blockquote>
<p>毛玻璃效果</p>
<blockquote>
<p>UIBlurEffect</p>
</blockquote>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//代码示例</span></div><div class="line"><span class="built_in">UIImageView</span> *iv = [<span class="built_in">UIImageView</span> new];</div><div class="line">[<span class="keyword">self</span>.view addSubview:iv];</div><div class="line">[iv mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">make.edges.equalTo(<span class="built_in">UIEdgeInsetsMake</span>(<span class="number">64</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</div><div class="line">&#125;];</div><div class="line"></div><div class="line">iv.image = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@"pic2.jpg"</span>];</div><div class="line"></div><div class="line"><span class="built_in">UIBlurEffect</span> *blur = [<span class="built_in">UIBlurEffect</span> effectWithStyle:<span class="built_in">UIBlurEffectStyleDark</span>];</div><div class="line"><span class="built_in">UIVisualEffectView</span> *effectView = [[<span class="built_in">UIVisualEffectView</span> alloc] initWithEffect:blur];</div><div class="line">[iv addSubview:effectView];</div><div class="line">[effectView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">make.edges.equalTo(<span class="number">0</span>);</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h2 id="iOS7-及之前版本"><a href="#iOS7-及之前版本" class="headerlink" title="iOS7 及之前版本"></a>iOS7 及之前版本</h2><p>在iOS7及之前的版本是没有上面用到的这两个API的。但在系统内部实际上已经有类似的API实现了，比如在导航栏和工具栏就已经实现了毛玻璃效果。这时，为了实现毛玻璃的效果，可以用到一个取巧的方法：将一个UIToolbar当成一个UIVisualEffectView贴上去</p>
<blockquote>
<p>UIToolbar</p>
</blockquote>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//代码示例</span></div><div class="line">UIToolbar *<span class="built_in">bar</span> = [[UIToolbar alloc] init];</div><div class="line">[iv addSubview:<span class="built_in">bar</span>];</div><div class="line">[<span class="built_in">bar</span> mas_makeConstraints:^(MASConstraintMaker *<span class="built_in">make</span>) &#123;</div><div class="line"><span class="built_in">make</span>.edges.equalTo(<span class="number">0</span>);</div><div class="line">&#125;];</div><div class="line">[<span class="built_in">bar</span> setBarStyle:UIBarStyleBlack];</div><div class="line"><span class="built_in">bar</span>.translatesAutoresizingMaskIntoConstraints = NO;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/11/Mac各种配置/Mac配置Apache和PHP/" itemprop="url">
                  Mac配置Apache和PHP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-11T16:17:50+08:00" content="2016-10-11">
              2016-10-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Mac配置/" itemprop="url" rel="index">
                    <span itemprop="name">Mac配置</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/11/Mac各种配置/Mac配置Apache和PHP/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/11/Mac各种配置/Mac配置Apache和PHP/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mac-Apache启动与相关配置"><a href="#Mac-Apache启动与相关配置" class="headerlink" title="Mac Apache启动与相关配置"></a>Mac Apache启动与相关配置</h1><p>在Mac OS 系统中已经默认安装了Apache服务器！</p>
<h2 id="启动Apache"><a href="#启动Apache" class="headerlink" title="启动Apache"></a>启动Apache</h2><p>关于Apahce的一些操作命名 （其中一些可能需要使用sudo来提高权限）<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Apache版本</span></div><div class="line">$ apachectl -v</div><div class="line"><span class="built_in">Server</span> version: Apache/<span class="number">2.4</span><span class="number">.23</span> (Unix)</div><div class="line"><span class="built_in">Server</span> built:   Aug  <span class="number">8</span> <span class="number">2016</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">34</span></div><div class="line"></div><div class="line"><span class="comment">//启动Apache 可能需要管理员密码</span></div><div class="line">sudo apachectl star</div></pre></td></tr></table></figure></p>
<p>验证Apache是否启动</p>
<p>在浏览器地址栏中输入 </p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span><span class="comment">//localhost</span></div></pre></td></tr></table></figure>
<p>如果出现 “It works!” 界面说明启动成功</p>
<h2 id="配置Apache"><a href="#配置Apache" class="headerlink" title="配置Apache"></a>配置Apache</h2><p>Apache的安装目录在：/etc/apache2/<br>Apache的默认根目录: /Library（资源库）/WebServer/Documents/</p>
<h3 id="设置Apache虚拟主机"><a href="#设置Apache虚拟主机" class="headerlink" title="设置Apache虚拟主机"></a>设置Apache虚拟主机</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#cd</span> 到Apache安装目录</div><div class="line">$ cd /etc/apache2/</div><div class="line"></div><div class="line">#需要修改到httpd.conf文件，最好先将其拷贝一份</div><div class="line"></div><div class="line">#备份httpd<span class="selector-class">.conf</span></div><div class="line"><span class="variable">$sudo</span> cp httpd<span class="selector-class">.conf</span> httpd<span class="selector-class">.conf</span><span class="selector-class">.copy</span></div><div class="line"></div><div class="line">#开始配置</div><div class="line"><span class="variable">$sudo</span> vim httpd.conf</div></pre></td></tr></table></figure>
<p>找到“#Include /private/etc/apache2/extra/httpd-vhosts.conf” 将前面的#号去掉，在Vim中，在命令界面下可以使用“/”来搜索</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Virtual hosts</span></div><div class="line">Include <span class="regexp">/private/</span>etc<span class="regexp">/apache2/</span>extra<span class="regexp">/httpd-vhosts.conf</span></div></pre></td></tr></table></figure>
<p>重启Apache来启动配置 开启虚拟主机配置功能</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#重启Apache </span></div><div class="line">$sudo apachectl restart</div></pre></td></tr></table></figure>
<p>虚拟主机文件路径：/etc/apache2/extra/httpd-vhosts.conf</p>
<p>配置虚拟主机文件<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#同样，备份之前保存原件</span></div><div class="line">$sudo cp httpd-vhosts.conf httpd-vhosts.conf.bak</div><div class="line"></div><div class="line">$sudo vim <span class="meta-keyword">/etc/</span>apache2<span class="meta-keyword">/extra/</span>httpd-vhosts.conf</div><div class="line"></div><div class="line"><span class="meta">#删掉以前的，增加如下的</span></div><div class="line"><span class="meta">#这个是系统层级的，不要随意改动</span></div><div class="line"><span class="params">&lt;VirtualHost *:<span class="number">80</span>&gt;</span></div><div class="line">    DocumentRoot <span class="string">"/Library/WebServer/Documents"</span></div><div class="line">    ServerName localhost</div><div class="line">    ErrorLog <span class="string">"/private/var/log/apache2/localhost-error_log"</span></div><div class="line">    CustomLog <span class="string">"/private/var/log/apache2/localhost-access_log"</span> common</div><div class="line"><span class="params">&lt;/VirtualHost&gt;</span></div><div class="line"></div><div class="line"><span class="meta">#这个是自己的，要根据自己的需求配置</span></div><div class="line"><span class="meta">#DocumentRoot是自己的站点的根目录</span></div><div class="line"><span class="meta">#ServerName 是自己站点的名称</span></div><div class="line"><span class="params">&lt;VirtualHost *:<span class="number">80</span>&gt;</span></div><div class="line">    DocumentRoot <span class="string">"/Users/liujin/Sites"</span></div><div class="line">    ServerName www.ljsites.com</div><div class="line">    ErrorLog <span class="string">"/private/var/log/apache2/sites-error_log"</span></div><div class="line">    CustomLog <span class="string">"/private/var/log/apache2/sites-access_log"</span> common</div><div class="line">    <span class="params">&lt;Directory /&gt;</span></div><div class="line">                Options Indexes FollowSymLinks MultiViews</div><div class="line">                AllowOverride None</div><div class="line">                Order deny,allow</div><div class="line">                Allow from all</div><div class="line">      <span class="params">&lt;/Directory&gt;</span></div><div class="line"><span class="params">&lt;/VirtualHost&gt;</span></div></pre></td></tr></table></figure></p>
<p>修改hosts配置文件</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#增加一条</div><div class="line">127<span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.1</span>       <span class="selector-tag">www</span><span class="selector-class">.ljsites</span><span class="selector-class">.com</span></div></pre></td></tr></table></figure>
<p>还需要打开Apache的默认权限</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="section">&lt;Directory /&gt;</span></div><div class="line"><span class="comment">#    AllowOverride none</span></div><div class="line"><span class="comment">#    Require all denied</span></div><div class="line">    <span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</div><div class="line">    <span class="attribute">AllowOverride</span> None</div><div class="line"><span class="section">&lt;/Directory&gt;</span></div></pre></td></tr></table></figure>
<p>重启Apache<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">sudo apachectl restart</span></div></pre></td></tr></table></figure></p>
<h2 id="配置PHP"><a href="#配置PHP" class="headerlink" title="配置PHP"></a>配置PHP</h2><p>如果你上面都做成功了，那么开启PHP也就简单多了。</p>
<p>Mac中已经默认安装了PHP了，在Apache中配置就好了</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">vim</span> httpd.<span class="keyword">conf</span></div><div class="line"></div><div class="line">#将这句话的注释打开</div><div class="line">LoadModule php5_module libexec/apache2/libphp5.<span class="keyword">so</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/08/iOS开发/Context/" itemprop="url">
                  CGContext
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-08T17:11:37+08:00" content="2016-10-08">
              2016-10-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/08/iOS开发/Context/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/08/iOS开发/Context/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简单示例——画一条线"><a href="#简单示例——画一条线" class="headerlink" title="简单示例——画一条线"></a>简单示例——画一条线</h2><p><img src="http://note.youdao.com/yws/api/personal/file/WEB98f9bd9c1e545e1b3b345371fe47e67c?method=download&amp;shareKey=852a99b9ff5d8ce0eaaa60b8a4b17b3c" alt="image"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取当前图形上下文</span></div><div class="line"><span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="comment">//将画笔的起点移动到（100，100）</span></div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="comment">//画一条线，起点为(100，100) 终点（200，100）</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">200</span>, <span class="number">100</span>);</div><div class="line"><span class="comment">//设置画笔的宽度</span></div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">5.0</span>f);</div><div class="line"><span class="comment">//设置画笔的颜色</span></div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> redColor].CGColor);</div><div class="line"><span class="comment">//让画笔在图形上下文中画画</span></div><div class="line"><span class="built_in">CGContextStrokePath</span>(ctx);</div></pre></td></tr></table></figure>
<h2 id="简单示例二——画一个正方形"><a href="#简单示例二——画一个正方形" class="headerlink" title="简单示例二——画一个正方形"></a>简单示例二——画一个正方形</h2><p><img src="http://note.youdao.com/yws/api/personal/file/WEB336971125b5f99eea6e2880e53150055?method=download&amp;shareKey=02532a25231bd37d7aa273e411cb7828" alt="image"></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取当前图形上下文</span></div><div class="line"><span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line"><span class="comment">//将画笔的起点移动到（100，100）</span></div><div class="line"><span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="comment">//画一条线，起点为(100，100) 终点（200，100）</span></div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">200</span>, <span class="number">100</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">200</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">100</span>, <span class="number">200</span>);</div><div class="line"><span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">100</span>, <span class="number">100</span>);</div><div class="line"><span class="comment">//设置画笔的宽度</span></div><div class="line"><span class="built_in">CGContextSetLineWidth</span>(ctx, <span class="number">5.0</span>f);</div><div class="line"><span class="comment">//将起点和终点闭合起来</span></div><div class="line"><span class="built_in">CGContextClosePath</span>(ctx);</div><div class="line"><span class="comment">//设置画笔的颜色</span></div><div class="line"><span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [<span class="built_in">UIColor</span> redColor].CGColor);</div><div class="line"><span class="comment">//让画笔在图形上下文中画画</span></div><div class="line"><span class="built_in">CGContextStrokePath</span>(ctx);</div></pre></td></tr></table></figure>
<p><a href="http://note.youdao.com/yws/api/personal/file/WEB6400c8ffc27d0de4c21822bdeb5dcef2?method=download&amp;inline=true&amp;shareKey=a818d5ff398f55f4c6660024f0c0f541" target="_blank" rel="external">Demo下载</a></p>
<h2 id="使用Context绘图的步骤"><a href="#使用Context绘图的步骤" class="headerlink" title="使用Context绘图的步骤"></a>使用Context绘图的步骤</h2><ol>
<li>获取图形上下文：</li>
</ol>
<p>一般是获取当前图形上下文，也可以根据需要自行创建其它的<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">CGContextRef ctx</span> = UIGraphicsGetCurrentContext();</div></pre></td></tr></table></figure></p>
<ol>
<li>绘制图形：</li>
</ol>
<p>先设置绘制起点</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextMoveToPoint(<span class="name">ctx</span>, <span class="number">100</span>, <span class="number">100</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>然后根据需要绘制图形</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextAddLineToPoint(<span class="name">ctx</span>, <span class="number">200</span>, <span class="number">100</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<ol>
<li>绘制参数配置：</li>
</ol>
<p>宽度：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextSetLineWidth(<span class="name">ctx</span>, <span class="number">5.0</span>f)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>颜色：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">CGContextSetStrokeColorWithColor</span>(<span class="selector-tag">ctx</span>, <span class="selector-attr">[UIColor redColor]</span><span class="selector-class">.CGColor</span>);</div></pre></td></tr></table></figure>
<ol>
<li>将图形上下文绘制出来：</li>
</ol>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextStrokePath(<span class="name">ctx</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<h2 id="Context的几个注意点"><a href="#Context的几个注意点" class="headerlink" title="Context的几个注意点"></a>Context的几个注意点</h2><h3 id="为什么要使用起点移动函数？"><a href="#为什么要使用起点移动函数？" class="headerlink" title="为什么要使用起点移动函数？"></a><em>为什么要使用起点移动函数？</em></h3><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextMoveToPoint(<span class="name">ctx</span>, <span class="number">100</span>, <span class="number">100</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>解释：因为很多Context的绘制函数是没有包含起点参数的，但是绘制图形又必须有一个起点：比如上面的绘制直线函数：CGContextAddLineToPoint(ctx, 200, 100)参数只是告诉终点位置是（200，100）。并没有起点参数。在图形上下文中会给出起点，起点有两种情况：</p>
<ol>
<li>使用CGContextMoveToPoint函数给出指定位置为起点</li>
<li>不指定位置情况下，默认使用上次绘图的终点为本次绘图的起点</li>
</ol>
<p>由此，第一次绘图的时候是没有上次绘图的终点，这时便要给出指定位置的起点。</p>
<h3 id="起点和终点怎么闭合？"><a href="#起点和终点怎么闭合？" class="headerlink" title="起点和终点怎么闭合？"></a><em>起点和终点怎么闭合？</em></h3><p>在使用绘线函数绘制闭合图形时，会出现起点和终点无法闭合的情况：</p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB9ed95c4ae70749df58ad13519687b8ad?method=download&amp;shareKey=cfbc6cf2981002d82841ba2ea0db6834" alt="image"></p>
<p>使用函数解决<br><figure class="highlight less"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//将起点和终点闭合起来</span></div><div class="line"><span class="selector-tag">CGContextClosePath</span>(ctx);</div></pre></td></tr></table></figure></p>
<h3 id="CGContextStrokePath和CGContextFillPath的区别"><a href="#CGContextStrokePath和CGContextFillPath的区别" class="headerlink" title="CGContextStrokePath和CGContextFillPath的区别"></a><em>CGContextStrokePath和CGContextFillPath的区别</em></h3><p>CGContextStrokePath是绘制边<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CGContextSetStrokeColorWithColor(<span class="name">ctx</span>, [UIColor redColor].CGColor)<span class="comment">;</span></div><div class="line">CGContextStrokePath(<span class="name">ctx</span>)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>CGContextFillPath是填充</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[[<span class="name">UIColor</span> purpleColor] set]<span class="comment">;</span></div><div class="line">CGContextFillPath(<span class="name">ctx</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBf64eb8644c1de99f47aa81f2a9ad7b25?method=download&amp;shareKey=612230f9050e5912511d9d8b1d64b1df" alt="image"></p>
<h2 id="Context其它绘制函数"><a href="#Context其它绘制函数" class="headerlink" title="Context其它绘制函数"></a>Context其它绘制函数</h2><p>画弧<br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> <span class="built_in">CGContextAddArc</span>(<span class="built_in">CGContextRef</span> __<span class="keyword">nullable</span> c, <span class="built_in">CGFloat</span> x, <span class="built_in">CGFloat</span> y,</div><div class="line">    <span class="built_in">CGFloat</span> radius, <span class="built_in">CGFloat</span> startAngle, <span class="built_in">CGFloat</span> endAngle, <span class="keyword">int</span> clockwise)</div><div class="line"><span class="comment">//圆心（x,y）、半径 radius、开始角 startAngle、结束角 endStart、绘制方向 clockwise</span></div><div class="line"><span class="comment">//示例</span></div><div class="line"><span class="built_in">CGContextAddArc</span>(ctx, <span class="number">150</span>, <span class="number">150</span>, <span class="number">50</span>, <span class="number">0</span>, M_PI_4, <span class="literal">YES</span>);</div></pre></td></tr></table></figure></p>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB7dc2e677363b0ec649387293074f41d9?method=download&amp;shareKey=6979128287040dd3d1494c279a6df126" alt="image"></p>
<p>画矩形</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextAddRect(ctx, CGRectMake(<span class="number">80</span>, <span class="number">80</span>, <span class="number">200</span>, <span class="number">100</span>));</div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB3ced639793970ff1fabcf787619cba53?method=download&amp;shareKey=051d2262078d81071b525ee64632d5af" alt="image"></p>
<p>画曲线</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextAddCurveToPoint(ctx, <span class="number">200</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">200</span>);</div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEB5589f48e553c0e08a4dcb36c18490b2e?method=download&amp;shareKey=fd355a40bc260311fdeb871363255ff1" alt="image"></p>
<p>画椭圆</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextAddEllipseInRect(ctx, CGRectMake(<span class="number">100</span>, <span class="number">100</span>, <span class="number">300</span>, <span class="number">200</span>));</div></pre></td></tr></table></figure>
<p><img src="http://note.youdao.com/yws/api/personal/file/WEBd02445e7942598e9eb890106a3d04e07?method=download&amp;shareKey=f269636280541f08a799fd38cf981879" alt="image"></p>
<h2 id="Context参数配置函数"><a href="#Context参数配置函数" class="headerlink" title="Context参数配置函数"></a>Context参数配置函数</h2><p>设置线的端点为圆角<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextSetLineCap(<span class="name">ctx</span>, kCGLineCapRound)<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>设置线之间的交点为圆角</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextSetLineJoin(<span class="name">ctx</span>, kCGLineJoinRound)<span class="comment">;</span></div></pre></td></tr></table></figure>
<p>设置透明度</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGContextSetAlpha(<span class="name">ctx</span>, <span class="number">0.3</span>)<span class="comment">;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/08/Linux/CentOS7.2 配置FTP服务器/" itemprop="url">
                  FTP服务器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-08T17:11:37+08:00" content="2016-10-08">
              2016-10-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Linux服务器/" itemprop="url" rel="index">
                    <span itemprop="name">Linux服务器</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/08/Linux/CentOS7.2 配置FTP服务器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/10/08/Linux/CentOS7.2 配置FTP服务器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="安装vsftpd"><a href="#安装vsftpd" class="headerlink" title="安装vsftpd"></a>安装vsftpd</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#安装vsftpd</span></div><div class="line">yum <span class="keyword">install</span> vsftpd </div><div class="line"><span class="comment">#安装vsftpd虚拟用户配置依赖包</span></div><div class="line">yum <span class="keyword">install</span> -y psmisc net-tools systemd-devel libdb-devel perl-DBI</div></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#启动</span></div><div class="line">systemctl start vsftpd.service </div><div class="line"><span class="meta">#设置vsftpd开机启动</span></div><div class="line">systemctl enable vsftpd.service</div></pre></td></tr></table></figure>
<h3 id="配置防火墙，开启FTP服务器需要的端口"><a href="#配置防火墙，开启FTP服务器需要的端口" class="headerlink" title="配置防火墙，开启FTP服务器需要的端口"></a>配置防火墙，开启FTP服务器需要的端口</h3><p>CentOS 7.2默认使用的是firewall作为防火墙，这里改为iptables防火墙。</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#停止firewall</span></div><div class="line">systemctl <span class="keyword">stop</span> firewalld.service </div><div class="line"><span class="meta">#禁止firewall开机启动</span></div><div class="line">systemctl <span class="keyword">disable</span> firewalld.service</div></pre></td></tr></table></figure>
<p>安装iptables防火墙</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum <span class="keyword">install</span> iptables-services <span class="comment">#安装</span></div></pre></td></tr></table></figure>
<p>配置tcp通信端口和FPT被动通道<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">vi /etc/sysconfig/iptables <span class="comment">#编辑防火墙配置文件</span></div><div class="line"></div><div class="line"><span class="comment"># sample configuration for iptables service</span></div><div class="line"><span class="comment"># you can edit this manually or use system-config-firewall</span></div><div class="line"><span class="comment"># please do not ask us to add additional ports/services to this default configuration</span></div><div class="line">*filter</div><div class="line">:INPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</div><div class="line">:FORWARD ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</div><div class="line">:OUTPUT ACCEPT [<span class="number">0</span>:<span class="number">0</span>]</div><div class="line">-A INPUT -m <span class="keyword">state</span> --state RELATED,ESTABLISHED -j ACCEPT</div><div class="line">-A INPUT -p icmp -j ACCEPT</div><div class="line">-A INPUT -i lo -j ACCEPT</div><div class="line">-A INPUT -p tcp -m <span class="keyword">state</span> --state NEW -m tcp --dport <span class="number">22</span> -j ACCEPT</div><div class="line"><span class="comment">#配置21端口</span></div><div class="line">-A INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">21</span> -j ACCEPT</div><div class="line"><span class="comment">#使用到10060到10090端口 这里的端口号要和第四步的pasv_min_port相对应</span></div><div class="line">-A INPUT -m <span class="keyword">state</span> --state NEW -m tcp -p tcp --dport <span class="number">10060</span>:<span class="number">10090</span> -j ACCEPT</div><div class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</div><div class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</div><div class="line">COMMIT</div></pre></td></tr></table></figure></p>
<p>（在vim中按i进入编辑模式才能进行编辑，按esc键退出编辑模式进入命令模式。:wq!保存退出）</p>
<p>启动iptables防火墙<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl restart iptables<span class="selector-class">.service</span> #最后重启防火墙使配置生效</div><div class="line"></div><div class="line">systemctl enable iptables<span class="selector-class">.service</span> #设置防火墙开机启动</div></pre></td></tr></table></figure></p>
<h3 id="关闭SELINUX"><a href="#关闭SELINUX" class="headerlink" title="关闭SELINUX"></a>关闭SELINUX</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">vi <span class="meta-keyword">/etc/</span>selinux/config</div><div class="line"></div><div class="line"><span class="meta">#SELINUX=enforcing #注释掉</span></div><div class="line"></div><div class="line"><span class="meta">#SELINUXTYPE=targeted #注释掉</span></div><div class="line"></div><div class="line">SELINUX=disabled <span class="meta">#增加</span></div><div class="line"></div><div class="line">:wq! <span class="meta">#保存退出</span></div><div class="line"></div><div class="line">setenforce <span class="number">0</span> <span class="meta">#使配置立即生效</span></div></pre></td></tr></table></figure>
<h3 id="配置vsftp服务器"><a href="#配置vsftp服务器" class="headerlink" title="配置vsftp服务器"></a>配置vsftp服务器</h3><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#备份默认配置文件</span></div><div class="line">cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf-bak </div><div class="line"></div><div class="line"><span class="meta">#进入vsftpd配置文件</span></div><div class="line">vim /etc/vsftpd/vsftpd.conf </div><div class="line"><span class="meta"># 禁止匿名用户anonymous登录</span></div><div class="line">anonymous_enable=NO</div><div class="line"><span class="meta"># 允许本地用户登录</span></div><div class="line">local_enable=YES</div><div class="line"><span class="meta"># 让登录的用户有写权限(上传，删除)</span></div><div class="line">write_enable=YES</div><div class="line"><span class="meta"># 默认umask</span></div><div class="line">local_umask=<span class="number">022</span></div><div class="line"><span class="meta"># 把传输记录的日志保存到/var/log/vsftpd.log</span></div><div class="line">xferlog_enable=YES</div><div class="line"><span class="meta">#xferlog_file=/var/log/vsftpd.log</span></div><div class="line">xferlog_std_format=YES</div><div class="line"><span class="meta"># 允许ASCII模式上传</span></div><div class="line"><span class="meta">#ascii_upload_enable=YES </span></div><div class="line"><span class="meta"># 允许ASCII模式下载</span></div><div class="line"><span class="meta">#ascii_download_enable=YES</span></div><div class="line"><span class="meta"># 使用20号端口传输数据</span></div><div class="line">connect_from_port_20=YES</div><div class="line"><span class="meta"># 欢迎标语</span></div><div class="line">ftpd_banner=Welcome to use my test ftp server.</div><div class="line"><span class="meta"># 接下来的三条配置很重要</span></div><div class="line"><span class="meta"># chroot_local_user设置了YES，那么所有的用户默认将被chroot，</span></div><div class="line"><span class="meta"># 也就用户目录被限制在了自己的home下，无法向上改变目录。</span></div><div class="line"><span class="meta"># chroot_list_enable设置了YES，即让chroot用户列表有效。</span></div><div class="line"><span class="meta"># ★超重要：如果chroot_local_user设置了YES，那么chroot_list_file</span></div><div class="line"><span class="meta"># 设置的文件里，是不被chroot的用户(可以向上改变目录)</span></div><div class="line"><span class="meta"># ★超重要：如果chroot_local_user设置了NO，那么chroot_list_file</span></div><div class="line"><span class="meta"># 设置的文件里，是被chroot的用户(无法向上改变目录)</span></div><div class="line">chroot_list_enable=YES</div><div class="line"><span class="meta"># touch /etc/vsftpd/chroot_list 新建</span></div><div class="line"><span class="meta">#chroot_list_file=/etc/vsftpd/chroot_list</span></div><div class="line">use_localtime=YES</div><div class="line"><span class="meta"># 以standalone模式在ipv4上运行</span></div><div class="line">listen=YES</div><div class="line"><span class="meta"># PAM认证服务名，这里默认是vsftpd，在安装vsftpd的时候已经创建了这个pam文件，</span></div><div class="line"><span class="meta"># 在/etc/pam.d/vsftpd，根据这个pam文件里的设置，/etc/vsftpd/ftpusers</span></div><div class="line"><span class="meta"># 文件里的用户将禁止登录ftp服务器，比如root这样敏感的用户，所以你要禁止别的用户</span></div><div class="line"><span class="meta"># 登录的时候，也可以把该用户追加到/etc/vsftpd/ftpusers里。</span></div><div class="line">pam_service_name=vsftpd</div><div class="line"></div><div class="line"><span class="meta">#这个特别重要 不然不能在可读文件夹建立FTP服务器</span></div><div class="line">allow_writeable_chroot=YES</div><div class="line"></div><div class="line"><span class="meta">#</span></div><div class="line">userlist_enable=YES</div><div class="line"><span class="meta">#</span></div><div class="line">tcp_wrappers=YES</div><div class="line"></div><div class="line">listen_port=<span class="number">21</span></div><div class="line"></div><div class="line"><span class="meta">#</span></div><div class="line">guest_enable=YES</div><div class="line"><span class="meta">#</span></div><div class="line">guest_username=ftproot</div><div class="line"></div><div class="line">user_config_dir=/etc/vsftpd/vconf</div><div class="line"><span class="meta">#</span></div><div class="line">virtual_use_local_privs=YES</div><div class="line"></div><div class="line"><span class="meta">#要加上这两个，不然ls命令会报错，这里相当于开启被动通信通道</span></div><div class="line">pasv_min_port=<span class="number">10060</span></div><div class="line"><span class="meta">#</span></div><div class="line">pasv_max_port=<span class="number">10090</span></div><div class="line"></div><div class="line"><span class="meta"># 重启 vsftpd</span></div><div class="line">service vsftpd restart</div></pre></td></tr></table></figure>
<h2 id="新建系统用户ftproot"><a href="#新建系统用户ftproot" class="headerlink" title="新建系统用户ftproot"></a>新建系统用户ftproot</h2><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#使用命令(adduser)添加ftproot用户,不能登录系统(-s /sbin/nologin),自己的文件夹在(-d /home/ftproot))</span></div><div class="line">useradd ftproot -d /home/ftproot -s /sbin/nologin</div><div class="line"><span class="meta">#设置密码</span></div><div class="line">passwd <span class="keyword">virtual</span></div></pre></td></tr></table></figure>
<p>==此时已经可以通过ftproot用户登录ftp服务器了==</p>
<h3 id="为FTP服务器创建虚拟用户"><a href="#为FTP服务器创建虚拟用户" class="headerlink" title="为FTP服务器创建虚拟用户"></a>为FTP服务器创建虚拟用户</h3><h4 id="建立虚拟用户名单文件"><a href="#建立虚拟用户名单文件" class="headerlink" title="建立虚拟用户名单文件"></a>建立虚拟用户名单文件</h4><p>编辑虚拟用户名单文件：（第一行账号，第二行密码，注意：不能使用root做用户名，系统保留）<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">vim /etc/vsftpd/virtusers</div><div class="line"></div><div class="line">guest</div><div class="line"><span class="number">123456</span></div><div class="line">family</div><div class="line"><span class="number">654321</span></div></pre></td></tr></table></figure></p>
<h4 id="生成虚拟用户数据文件"><a href="#生成虚拟用户数据文件" class="headerlink" title="生成虚拟用户数据文件"></a>生成虚拟用户数据文件</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">db_load -T -t hash -f <span class="regexp">/etc/</span>vsftpd<span class="regexp">/virtusers /</span>etc<span class="regexp">/vsftpd/</span>virtusers.db</div><div class="line"></div><div class="line">chmod <span class="number">600</span> <span class="regexp">/etc/</span>vsftpd<span class="regexp">/virtusers.db #设定PAM验证文件，并指定对虚拟用户数据库文件进行读取</span></div></pre></td></tr></table></figure>
<h4 id="在-etc-pam-d-vsftpd的文件头部加入以下信息（在后面加入无效"><a href="#在-etc-pam-d-vsftpd的文件头部加入以下信息（在后面加入无效" class="headerlink" title="在/etc/pam.d/vsftpd的文件头部加入以下信息（在后面加入无效"></a>在/etc/pam.d/vsftpd的文件头部加入以下信息（在后面加入无效</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#修改前先备份 </span></div><div class="line">cp <span class="meta-keyword">/etc/</span>pam.d/vsftpd <span class="meta-keyword">/etc/</span>pam.d/vsftpdbak</div><div class="line"></div><div class="line">vi <span class="meta-keyword">/etc/</span>pam.d/vsftpd</div><div class="line"></div><div class="line">auth sufficient <span class="meta-keyword">/lib64/</span>security/pam_userdb.so db=<span class="meta-keyword">/etc/</span>vsftpd/virtusers</div><div class="line"></div><div class="line">account sufficient <span class="meta-keyword">/lib64/</span>security/pam_userdb.so db=<span class="meta-keyword">/etc/</span>vsftpd/virtusers</div></pre></td></tr></table></figure>
<p>注意：如果系统为32位，上面改为lib，否则配置失败</p>
<h4 id="建立虚拟用户个人Vsftp的配置文件"><a href="#建立虚拟用户个人Vsftp的配置文件" class="headerlink" title="建立虚拟用户个人Vsftp的配置文件"></a>建立虚拟用户个人Vsftp的配置文件</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">mkdir /etc/vsftpd/vconf</div><div class="line"></div><div class="line">cd /etc/vsftpd/vconf</div><div class="line"></div><div class="line">touch ljftp admin <span class="comment">#这里创建三个虚拟用户配置文件</span></div><div class="line"></div><div class="line">mkdir -p /home/ftpRoot/ljftp</div><div class="line"></div><div class="line">vi web1 <span class="comment">#编辑用户web1配置文件，其他的跟这个配置文件类似</span></div><div class="line"></div><div class="line">local_root=/home/ftpRoot/ljftp/</div><div class="line"></div><div class="line">write_enable=YES</div><div class="line"></div><div class="line">anon_world_readable_only=NO</div><div class="line"></div><div class="line">anon_upload_enable=YES</div><div class="line"></div><div class="line">anon_mkdir_write_enable=YES</div><div class="line"></div><div class="line">anon_other_write_enable=YES</div></pre></td></tr></table></figure>
<p>打开虚拟用户的写入文件夹权限</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chown <span class="string">ftproot:</span>ftproot <span class="regexp">/home/</span>ftproot<span class="regexp">/guest/</span></div><div class="line">chown <span class="string">ftproot:</span>ftproot <span class="regexp">/home/</span>ftproot<span class="regexp">/family/</span></div></pre></td></tr></table></figure>
<p>==至此,可以使用虚拟用户guest和family登陆ftp==</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://note.youdao.com/yws/api/personal/file/WEB4b94daf00c4060c6efc2b3bf12646d46?method=download&inline=true&shareKey=541c48a7c51931198062a6ecd777028c"
               alt="刘瑾" />
          <p class="site-author-name" itemprop="name">刘瑾</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">23</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘瑾</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"> 访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span>
  

  
    <span class="site-pv"><i class="fa fa-eye"> 访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"liujinxixi"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
